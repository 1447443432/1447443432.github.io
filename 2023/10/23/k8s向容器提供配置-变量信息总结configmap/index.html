<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>k8s向容器提供配置-变量信息总结configmap | 编程知识学习笔记</title><meta name="author" content="小井"><meta name="copyright" content="小井"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="以下将介绍向容器提供配置信息的几种方法通过命令行参数进行配置       在制作Docker镜像时，Dockerfile中的ENTRYPOINT和CMD指令可用于指定容器启动时要运行的程序及相关参数。CMD指令以列表的形式指定要运行的程序和相关参数，但是如果同时存在ENTRYPOINT指令，则CMD指令中列表的所有元素都将被作为由ENTRYPOINT指定程序的命令行参数。另外在基于某镜像使用Doc">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s向容器提供配置-变量信息总结configmap">
<meta property="og:url" content="https://blog.jing.xj.cn/2023/10/23/k8s%E5%90%91%E5%AE%B9%E5%99%A8%E6%8F%90%E4%BE%9B%E9%85%8D%E7%BD%AE-%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF%E6%80%BB%E7%BB%93configmap/index.html">
<meta property="og:site_name" content="编程知识学习笔记">
<meta property="og:description" content="以下将介绍向容器提供配置信息的几种方法通过命令行参数进行配置       在制作Docker镜像时，Dockerfile中的ENTRYPOINT和CMD指令可用于指定容器启动时要运行的程序及相关参数。CMD指令以列表的形式指定要运行的程序和相关参数，但是如果同时存在ENTRYPOINT指令，则CMD指令中列表的所有元素都将被作为由ENTRYPOINT指定程序的命令行参数。另外在基于某镜像使用Doc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.jing.xj.cn/img/favicon.png">
<meta property="article:published_time" content="2023-10-23T08:27:00.000Z">
<meta property="article:modified_time" content="2023-10-23T08:28:01.601Z">
<meta property="article:author" content="小井">
<meta property="article:tag" content="运维">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.jing.xj.cn/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.jing.xj.cn/2023/10/23/k8s%E5%90%91%E5%AE%B9%E5%99%A8%E6%8F%90%E4%BE%9B%E9%85%8D%E7%BD%AE-%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF%E6%80%BB%E7%BB%93configmap/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'k8s向容器提供配置-变量信息总结configmap',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-23 16:28:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 作者简介</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="编程知识学习笔记"><span class="site-name">编程知识学习笔记</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 作者简介</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">k8s向容器提供配置-变量信息总结configmap</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-23T08:27:00.000Z" title="发表于 2023-10-23 16:27:00">2023-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-23T08:28:01.601Z" title="更新于 2023-10-23 16:28:01">2023-10-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/kubernetes-k8s%E5%AD%98%E5%82%A8/">kubernetes-k8s存储</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="k8s向容器提供配置-变量信息总结configmap"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h4 id="以下将介绍向容器提供配置信息的几种方法"><a href="#以下将介绍向容器提供配置信息的几种方法" class="headerlink" title="以下将介绍向容器提供配置信息的几种方法"></a>以下将介绍向容器提供配置信息的几种方法</h4><h4 id="通过命令行参数进行配置"><a href="#通过命令行参数进行配置" class="headerlink" title="通过命令行参数进行配置"></a>通过命令行参数进行配置</h4><p>       在制作Docker镜像时，Dockerfile中的ENTRYPOINT和CMD指令可用于指定容器启动时要运行的程序及相关参数。CMD指令以列表的形式指定要运行的程序和相关参数，但是如果同时存在ENTRYPOINT指令，则CMD指令中列表的所有元素都将被作为由ENTRYPOINT指定程序的命令行参数。另外在基于某镜像使用Docker命令创建容器时，可以在命令行向ENTRYPOINT中的程序传递额外的自定义参数，甚至还可以修改要运行的应用程序本身，例如以下命令使用docker run创建并启动容器的格式为： <code>docker run [OPTINS] IMAGE [COMMAND] [ARG]</code></p>
<p><code>COMMAND</code>为自定义运行的程序，<code>ARG</code>为传递给程序的参数，假如定义相关镜像文件时使用了<code>ENTRYPOINT</code>指令，则<code>COMMAND</code>和<code>ARG</code>都会被当作命令行参数传递给<code>ENTRYPOINT</code>指令中指定的程序，除非运行docker run命令时额外使用<code>--entrypoint</code>选项来覆盖镜像文件中的<code>ENTRYPOINT</code>指定的程序。</p>
<p>在Kubernetes系统上创建Pod资源时，也能够向容器化应用传递命令行参数，甚至指定运行其它应用程序，相关的字段分别为<code>pods.spec.containers.command</code>和<code>pods.spec.containers.args</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create -f nginx.yaml</span><br><span class="line">[root@localhost configmap]# cat nginx.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ] </span><br></pre></td></tr></table></figure>

<p>Kubernetes配置文件中的command对应于Dockerfile中的ENTRYPOINT，而配置文件的args则对应于Dockerfile中的CMD。在Kubernetes中只给出command字段时，他会覆盖Dockerfile中的ENTRYPOINT和CMD，只给出args字段时，它仅覆盖CMD，而同时给出command和args时，它会对应覆盖ENTRYPOINT和CMD。</p>
<h4 id="将配置文件载入镜像文件"><a href="#将配置文件载入镜像文件" class="headerlink" title="将配置文件载入镜像文件"></a>将配置文件载入镜像文件</h4><p>       在通过Dockerfile制作镜像时，可以使用COPY或者ADD指定将定义好的配置文件直接复制到镜像文件系统上的相应位置，或者使用RUN指令调用sed或echo一类的命令修改配置文件从而达到为容器化应用提供自定义配置文件之目的。使用Docker Hub上的某镜像文件额外添加配置文件即能符合需要，则克隆其Dockerfile文件修改至符合需求之后再将之推送至GitHub，并由Docker Hub自动构建出镜像文件即可</p>
<h4 id="通过存储卷向容器注入配置信息"><a href="#通过存储卷向容器注入配置信息" class="headerlink" title="通过存储卷向容器注入配置信息"></a>通过存储卷向容器注入配置信息</h4><p>      Docker存储卷(volumes)能够将宿主机之上的任何文件或目录映射到容器文件系统之上，因此，可以事先将配置文件放置于宿主机之上的某个路径中，而后在启动容器时进行加载。这种方式灵活易用，但也依赖于用户需要事先将配置数据提供在宿主机上的特定路径下，而且在多主机模型中，若容器存在被调度至任一主机运行的可能性时，用户还需要将配置共享到任一宿主机来确保容器能够正常地获取到它们。</p>
<h4 id="通过环境变量向容器注入配置信息"><a href="#通过环境变量向容器注入配置信息" class="headerlink" title="通过环境变量向容器注入配置信息"></a>通过环境变量向容器注入配置信息</h4><p>      通过环境变量为容器提供配置信息是Docker Hub上最常见的使用方式，例如，使用MySQL官方提供的镜像文件启动MySQL容器时使用的<code>MYSQL_ROOT_PASSWORD</code>环境变量，它用于为MYSQL服务器的root用户设置登陆密码。</p>
<p>     在基于此类镜像启动容器时，用户为 docker run 命令通过 -e 选项向环境变量传值即能实现应用配置，命令的使用格式为 <code>docker run -e SETTING1=foo -e SETTING2=bar ... &lt;image name&gt;</code>。启动时，容器的<code>ENTRYPOINT</code>启动脚本会抓取到这些环境变量，并在启动容器应用之前，通过sed或echo等一类的命令将变量值替换到配置文件中。</p>
<p>     在Kubernetes中使用镜像启动容器时，可以在Pod资源或Pod模版资源为容器配置使用env参数来定义所使用的环境变量列表，即便容器中的应用本身没定义环境变量，也一样可以向容器传递环境变量，只不过它不被使用罢了。环境变量配置容器化应用时，需要在容器配置段中嵌套使用env字段，它的值是一个由环境变量构建的列表。环境变量由name和value（或valueFrom）字段构成。</p>
<ul>
<li><code>name&lt;string&gt;</code>：环境变量的名称，必须字段。</li>
<li><code>value&lt;string&gt;</code>：环境变量的值，通过 ${VAR_NAME} 引用，默认值为空。</li>
<li><code>valueFrom&lt;Object&gt;</code>：环境变量值的引用源，例如，当前Pod资源的名称、名称空间、标签等，不能与非空值的value字段同时使用，即环境变量的值要么源于value字段，要么源于valueFrom字段，二者不可同时提供数据。valueFrom字段可引用的值有多种来源，包括当前Pod资源的属性值，容器相关的系统资源配置、ConfigMap对象中的Key以及Secret对象中的Key，它们应分别使用不同的嵌套字段进行定义。</li>
<li><code>fieldRef&lt;Object&gt;</code>：当前Pod资源的指定字段，目前支持使用的字段包括 metadata.name、metadata.namespace、metadata.labels、metadata.annotations、spec.nodeName、spec.serviceAccountName、status.hostIP和status.podIP。</li>
<li><code>configMapKeyRef&lt;Object&gt;</code>：ConfigMap对象中的特定Key。</li>
<li><code>secretKeyRef&lt;Object&gt;</code>：Secret对象中的特定Key。</li>
<li><code>resourceFieldRef&lt;Object&gt;</code>：当前容器的特定系统资源的最小值(配额)或最大值(限额)，目前支持的引用包括limits.cpu、limts.ephemeral-storage、requests、cpu、requests.memory、requests.ephemeral-storage。</li>
</ul>
<p><code>valueFrom属性下面可以有</code></p>
<p> <code>1)fieldRef【fieldRef下面有</code>fieldPath<code>】</code></p>
<p> <code>2)configMapKeyRef</code></p>
<p> <code>3)secretKeyRef【fieldRef下面有name和key``】</code></p>
<p> <code>4)resourceFieldRef【resourceFieldRef下面有</code>resource<code>】</code></p>
<p>       下面是定义在配置文件 nginx.yaml 中的Pod资源，其通过环境变量引用当前Pod资源及其所在节点的相关属性值配置容器，fieldRef字段的值是一个对象，它一般由apiVersion(创建当前Pod资源的API版本)或fieldPath嵌套字段所定义：</p>
<h4 id="1）valueFrom：fieldRef【fieldRef下面有fieldPath】案列"><a href="#1）valueFrom：fieldRef【fieldRef下面有fieldPath】案列" class="headerlink" title="1）valueFrom：fieldRef【fieldRef下面有fieldPath】案列"></a><code>1）valueFrom：fieldRef【fieldRef下面有</code>fieldPath<code>】案列</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create -f nginx.yaml</span><br><span class="line">[root@localhost configmap]# cat nginx.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        env:</span><br><span class="line">        - name: HELLO_WORLD</span><br><span class="line">          value: just a demo</span><br><span class="line"></span><br><span class="line">        #fieldRef-&gt;fieldPath</span><br><span class="line">        - name: MY_NODE_NAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: spec.nodeName</span><br><span class="line">        - name: MY_NODE_IP</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: status.hostIP</span><br><span class="line">        - name: MY_POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line"></span><br><span class="line">        #resourceFieldRef-&gt;resource</span><br><span class="line">        - name: MY_REQUESTS_CPU</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: requests.cpu</span><br><span class="line">        - name: MY_REQUESTS_MEM</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: requests.memory</span><br><span class="line">        - name: MY_LIMITS_CPU</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: limits.cpu</span><br><span class="line">        - name: MY_LIMITS_MEM</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: limits.memory</span><br><span class="line"></span><br><span class="line">        #secretKeyRef-&gt;name|key</span><br><span class="line">        - name: USERNAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: mysecret</span><br><span class="line">              key: username        </span><br><span class="line">        - name: PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: mysecret</span><br><span class="line">              key: password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: &quot;250m&quot;</span><br><span class="line">            memory: &quot;64Mi&quot;</span><br><span class="line">          limits:</span><br><span class="line">            cpu: &quot;4000m&quot;</span><br><span class="line">            memory: &quot;8Gi&quot;</span><br><span class="line">      #restartPolicy: OnFailure</span><br></pre></td></tr></table></figure>

<p>然后打印它的环境变量列表 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   busybox-7d84ccb8cf-dztmv   -- printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=busybox-7d84ccb8cf-dztmv</span><br><span class="line">MY_NODE_IP=172.16.10.21</span><br><span class="line">MY_POD_NAMESPACE=default</span><br><span class="line">HELLO_WORLD=just a demo</span><br><span class="line">MY_NODE_NAME=172.16.10.21</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.43.0.1</span><br><span class="line">TERM=xterm</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h4 id="3）valueFrom：secretKeyRef【fieldRef下面有name和key-】案列"><a href="#3）valueFrom：secretKeyRef【fieldRef下面有name和key-】案列" class="headerlink" title="3）valueFrom：secretKeyRef【fieldRef下面有name和key``】案列"></a>3）<code>valueFrom：secretKeyRef【fieldRef下面有name和key``】案列</code></h4><p> 3.1)创建Secret对象</p>
<p>注意：data中的value内容必须是base64编码格式，可以使用<code>echo -n wubo|base64</code>完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# echo -n wubo | base64 </span><br><span class="line">d3Vibw==</span><br><span class="line">[root@localhost config]# echo -n 123456aA | base64 </span><br><span class="line">MTIzNDU2YUE=</span><br><span class="line">[root@localhost config]# cat secrets.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: mysecret</span><br><span class="line">data:</span><br><span class="line">  username: d3Vibw==</span><br><span class="line">  password: MTIzNDU2YUE=</span><br></pre></td></tr></table></figure>

<p>3.2)创建 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# kubectl create -f secrets.yaml </span><br><span class="line">[root@localhost config]# kubectl get secrets mysecret -o yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  password: MTIzNDU2YUE=</span><br><span class="line">  username: d3Vibw==</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: &quot;2022-12-29T06:06:17Z&quot;</span><br><span class="line">  name: mysecret</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;14208729&quot;</span><br><span class="line">  selfLink: /api/v1/namespaces/default/secrets/mysecret</span><br><span class="line">  uid: 55a84b3e-e597-4f95-aaac-5bf8543fbfc7</span><br><span class="line">type: Opaque</span><br></pre></td></tr></table></figure>

<p> 3.3)在pod中或deployment中使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        image: harbor.jettech.com/rancher/busybox:latest</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        env:</span><br><span class="line">        - name: USERNAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: mysecret</span><br><span class="line">              key: username        </span><br><span class="line">        - name: PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: mysecret</span><br><span class="line">              key: password</span><br></pre></td></tr></table></figure>

<p> 然后打印它的环境变量列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# kubectl exec -it busybox-d677b8c47-6frp4 -- env</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=busybox-d677b8c47-6frp4</span><br><span class="line">TERM=xterm</span><br><span class="line">USERNAME=wubo</span><br><span class="line">PASSWORD=123456aA</span><br><span class="line">MY_LIMITS_MEM=8589934592</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h4 id="4）valueFrom：-resourceFieldRef【resourceFieldRef下面有resource】案列"><a href="#4）valueFrom：-resourceFieldRef【resourceFieldRef下面有resource】案列" class="headerlink" title="4）valueFrom： resourceFieldRef【resourceFieldRef下面有resource】案列"></a>4）<code>valueFrom： resourceFieldRef【resourceFieldRef下面有</code>resource<code>】案列</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create -f nginx.yaml</span><br><span class="line">[root@localhost configmap]# cat nginx.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        env:</span><br><span class="line">        #resourceFieldRef-&gt;resource</span><br><span class="line">        - name: MY_REQUESTS_CPU</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: requests.cpu</span><br><span class="line">        - name: MY_REQUESTS_MEM</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: requests.memory</span><br><span class="line">        - name: MY_LIMITS_CPU</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: limits.cpu</span><br><span class="line">        - name: MY_LIMITS_MEM</span><br><span class="line">          valueFrom:</span><br><span class="line">            resourceFieldRef:</span><br><span class="line">              resource: limits.memory</span><br><span class="line"></span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: &quot;250m&quot;</span><br><span class="line">            memory: &quot;64Mi&quot;</span><br><span class="line">          limits:</span><br><span class="line">            cpu: &quot;4000m&quot;</span><br><span class="line">            memory: &quot;8Gi&quot;</span><br><span class="line">      #restartPolicy: OnFailure</span><br></pre></td></tr></table></figure>

<p>然后打印它的环境变量列表 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# kubectl exec -it busybox-759998fd64-k295s -- printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=busybox-759998fd64-k295s</span><br><span class="line">TERM=xterm</span><br><span class="line">MY_REQUESTS_CPU=1</span><br><span class="line">MY_REQUESTS_MEM=67108864</span><br><span class="line">MY_LIMITS_CPU=4</span><br><span class="line">MY_LIMITS_MEM=8589934592</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h4 id="2-valueFrom-configMapKeyRef案列如下："><a href="#2-valueFrom-configMapKeyRef案列如下：" class="headerlink" title="2)valueFrom configMapKeyRef案列如下："></a><code>2)valueFrom configMapKeyRef案列如下：</code></h4><p>容器的启动脚本或应用程序调用或处理这些环境变量、即可实现容器化应用的配置。相较于命令行参数的方式来说，使用环境变量的配置方式更清晰、易懂，尤其是对于首次使用相关容器的用户来说，这种方式能够快速了解容器的配置方式，不过这两种配置方式有一个共同缺陷：无法在容器应用运行过程中更新环境变量从而达到更新应用目的。这通常意味着用户不得不为production、development和qa等不同的环境分别配置Pod资源。好在，用户还有ConfigMap资源可用</p>
<h4 id="ConfigMap诞生的原因"><a href="#ConfigMap诞生的原因" class="headerlink" title="ConfigMap诞生的原因"></a>ConfigMap诞生的原因</h4><p>分布式环境中，基于负载、容错性等需求的考虑，几乎所有的服务都需要在不同的机器节点上部署不止一个实例。随着程序功能的日益复杂，程序的配置日益增多，而且配置文件的修改频率通常远远大于代码本身，这种情况下，有时仅仅是一个配置内容的修改，就不得不重新将代码提交到SVN&#x2F;Git、打包、分发上线的流程。部署规则较大的场景中，分发上线工作即繁杂又沉重。</p>
<p>究其根本，所有的这些麻烦都是由于配置和代码在管理和发布的过程中不加区分所致。配置本身源于代码，是为了提高代码的灵活性而提取出来的一些经常变化的或需要定制的内容，而正是配置的这种天生变化特性为部署过程中带来了不小的麻烦，也最终催生了分布式系统配置管理系统，将配置内容从代码中完全分离出来，及时可靠高效地提供配置访问和更新服务。</p>
<blockquote>
<p>国内分布式配置中心相关的开源项目有 Diamond(阿里)、Apollo(携程)、Qconf(奇虎360)和disconf(百度)等。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/" title="ConfigMap">ConfigMap</a>作为分布式系统的Kubernetes也提供了统一配置管理方案——ConfigMap。Kubernetes基于ConfigMap对象实现了将配置文件从容器镜像中解耦，从而增强了容器应用的可移植性。简单来说，一个ConfigMap对象就是一系列配置数据的集合，这些数据可“注入”到Pod对象中，并为容器应用所使用，<strong>注入方式有挂载为存储卷和传递为环境变量两种</strong></p>
<h4 id="ConfigMap对象创建-是namespace级别的"><a href="#ConfigMap对象创建-是namespace级别的" class="headerlink" title="ConfigMap对象创建 是namespace级别的"></a>ConfigMap对象创建 是namespace级别的</h4><p>ConfigMap创建的方式与其它资源一样有两种：</p>
<ul>
<li>kubectl create configmap 命令直接创建</li>
<li>通过资源配置清单创建</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/" title="ConfigMap">ConfigMap</a>以上两种对于ConfigMap都算是比较常用的创建方式，通过kubectl create configmap命令，用户可以根据目录、文件或者直接创建ConfigMap对象，命令的语法格式如下： <code>kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;</code></p>
<p><code>&lt;map-name&gt;</code>为ConfigMap对象的名称，<code>&lt;data-source&gt;</code>是数据源，数据源可以直接给定K&#x2F;V类型的数据，也可以指定文件以及目录来获取，无论是哪一种数据源，它都要转换为ConfigMap对象中的Key-Value数据，其中Key由用户在命令行给出或是文件数据源的文件名，它仅能由字母、数字、连接号和点号组成，而Value则是直接值或文件数据源的内容。</p>
<h4 id="1-通过键值创建ConfigMap"><a href="#1-通过键值创建ConfigMap" class="headerlink" title="1.通过键值创建ConfigMap"></a>1.通过键值创建ConfigMap</h4><p>利用<code>kubectl create configmap</code>命令使用<code>--from-literal</code>选项可在命令行直接给出键值对来创建ConfigMap对象，重复使用此选项则可以传递多个键值对，命令格式如下： <code>kubectl create configmap cm1 --from-literal=name=wubo</code></p>
<p>例如下面用命令创建special-config configmap时传递来两个键值对： 键值对第一个key为mysql_ip值为172.16.10.5键值对第二个key为mysql_port值为3306</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create configmap mysql-config  --from-literal=mysql_ip=172.16.10.5 --from-literal=mysql_port=3306 -n default</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl get configmap mysql-config  </span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">mysql-config   2      53s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用kubectl describe或-o yaml可以看到configmap中的原始数据</span><br><span class="line">[root@localhost configmap]# kubectl get configmap mysql-config  -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  mysql_ip: 172.16.10.5</span><br><span class="line">  mysql_port: &quot;3306&quot;</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: &quot;2022-01-26T03:54:51Z&quot;</span><br><span class="line">  name: mysql-config</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;601548&quot;</span><br><span class="line">  uid: 866f5011-7f14-43ba-88d1-53682a12ac6e</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl describe configmap mysql-config  </span><br><span class="line">Name:         mysql-config</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">mysql_ip:</span><br><span class="line">----</span><br><span class="line">172.16.10.5</span><br><span class="line">mysql_port:</span><br><span class="line">----</span><br><span class="line">3306</span><br><span class="line"></span><br><span class="line">BinaryData</span><br><span class="line">====</span><br><span class="line"></span><br><span class="line">Events:  &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>此类方式提供的数据量有限，一般是在仅通过有限的几个数据项即可为Pod资源提供足够的配置信息时使用。</p>
<p>1)定义configmap对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# kubectl create configmap mysql-config --from-literal=mysql_ip=172.16.10.1 --from-literal=mysql_name=root --from-literal=mysql_password=123456aA -n default</span><br></pre></td></tr></table></figure>

<p>2）deployment中使用 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        image: harbor.jettech.com/rancher/busybox:latest</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        env:</span><br><span class="line">        - name: MYSQL_IP</span><br><span class="line">          valueFrom:</span><br><span class="line">            configMapKeyRef:</span><br><span class="line">              name: mysql-config</span><br><span class="line">              key: mysql_ip</span><br><span class="line">        - name: MYSQL_NAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            configMapKeyRef:</span><br><span class="line">              name: mysql-config</span><br><span class="line">              key: mysql_name</span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            configMapKeyRef:</span><br><span class="line">              name: mysql-config</span><br><span class="line">              key: mysql_password</span><br></pre></td></tr></table></figure>

<p>3）打印变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost config]# kubectl exec -it busybox-655554f856-b6f8h -- printenv </span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=busybox-655554f856-b6f8h</span><br><span class="line">TERM=xterm</span><br><span class="line">MYSQL_IP=172.16.10.1</span><br><span class="line">MYSQL_NAME=root</span><br><span class="line">MYSQL_PASSWORD=123456aA</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h4 id="2-通过文件创建ConfigMap配置-Pod-使用-ConfigMap-Kubernetes"><a href="#2-通过文件创建ConfigMap配置-Pod-使用-ConfigMap-Kubernetes" class="headerlink" title="2.通过文件创建ConfigMap配置 Pod 使用 ConfigMap | Kubernetes"></a>2.通过文件创建ConfigMap<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-pod-configmap/" title="配置 Pod 使用 ConfigMap | Kubernetes">配置 Pod 使用 ConfigMap | Kubernetes</a></h4><p>利用<code>kubectl create configmap</code>命令使用<code>--from-file</code>选项可基于文件内容来创建ConfigMap对象，它的命令格式如下： <code>kubectl create configmap &lt;configmap_name&gt; --from-file=&lt;[key=]source</code></p>
<p><strong>1.准备配置文件</strong> 我们先准备好要载入容器的配置文件，等下通过kubectl create configmap config_name –from-file 来指定我们的配置文件即可创建configmap，以下准备了一个elasticsearch.yaml的配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat config/elasticsearch.yaml </span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: elastic</span><br><span class="line">path.data: /usr/local/elastic7.4/data</span><br><span class="line">path.logs: /usr/local/elastic7.4/logs</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">network.tcp.no_delay: true</span><br><span class="line">network.tcp.keep_alive: true</span><br><span class="line">network.tcp.reuse_address: true</span><br><span class="line">network.tcp.send_buffer_size: 256mb</span><br><span class="line">network.tcp.receive_buffer_size: 256mb</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">transport.tcp.compress: true</span><br><span class="line">http.max_content_length: 200mb</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [&quot;127.0.0.1:9300&quot;]</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line">xpack.monitoring.collection.enabled: true</span><br></pre></td></tr></table></figure>

<p><strong>2.通过文件创建configMap</strong> 如果指定文件创建configmap的时候没有指定key，那么kubernetes则以文件名称为key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create configmap elastic-configmap --from-file=config/elasticsearch.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl describe configmap elastic-configmap </span><br><span class="line">Name:         elastic-configmap</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">elasticsearch.yaml:                       #我们没有指定key，默认以文件名称为key</span><br><span class="line">----</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: elastic</span><br><span class="line">path.data: /usr/local/elastic7.4/data</span><br><span class="line">path.logs: /usr/local/elastic7.4/logs</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">network.tcp.no_delay: true</span><br><span class="line">network.tcp.keep_alive: true</span><br><span class="line">network.tcp.reuse_address: true</span><br><span class="line">network.tcp.send_buffer_size: 256mb</span><br><span class="line">network.tcp.receive_buffer_size: 256mb</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">transport.tcp.compress: true</span><br><span class="line">http.max_content_length: 200mb</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [&quot;127.0.0.1:9300&quot;]</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line">xpack.monitoring.collection.enabled: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BinaryData</span><br><span class="line">====</span><br><span class="line"></span><br><span class="line">Events:  &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>如果需要指定键名称，如下在文件前面写入key名称即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create configmap elastic-configmap --from-file=jettech-elastic-key=config/elasticsearch.yaml</span><br><span class="line">configmap/elastic-configmap created</span><br><span class="line">[root@localhost configmap]# kubectl describe configmap elastic-configmap </span><br><span class="line">Name:         elastic-configmap</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">jettech-elastic-key:                 #指定的key</span><br><span class="line">----</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: elastic</span><br><span class="line">path.data: /usr/local/elastic7.4/data</span><br><span class="line">path.logs: /usr/local/elastic7.4/logs</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">network.tcp.no_delay: true</span><br><span class="line">network.tcp.keep_alive: true</span><br><span class="line">network.tcp.reuse_address: true</span><br><span class="line">network.tcp.send_buffer_size: 256mb</span><br><span class="line">network.tcp.receive_buffer_size: 256mb</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">transport.tcp.compress: true</span><br><span class="line">http.max_content_length: 200mb</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [&quot;127.0.0.1:9300&quot;]</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line">xpack.monitoring.collection.enabled: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BinaryData</span><br><span class="line">====</span><br><span class="line"></span><br><span class="line">Events:  &lt;none&gt;</span><br></pre></td></tr></table></figure>

<h4 id="通过目录创建ConfigMap"><a href="#通过目录创建ConfigMap" class="headerlink" title="通过目录创建ConfigMap"></a>通过目录创建ConfigMap</h4><p>如果配置文件数量较多时，kubectl还提供了基于目录直接将多个文件分别收纳为键值数据的ConfigMap资源创建方式，将<code>--from-file</code>选项后所跟的路径指向一个目录路径就能把目录下的所有文件一同创建同一个 ConfigMap 资源中，命令格式如下： <code>kubectl create configmap &lt;configmap_name&gt; --from-file=&lt;path-to-directory&gt;</code></p>
<p>如下命令所示，将&#x2F;data&#x2F;configs&#x2F;nginx&#x2F;conf.d目录下的所有文件都保存于nginx-config-files对象中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# ls config/</span><br><span class="line">elasticsearch.yaml  my.cnf  nginx.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl create configmap elastic-configmap --from-file=config/</span><br><span class="line">configmap/elastic-configmap created</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl describe configmap elastic-configmap </span><br></pre></td></tr></table></figure>

<p>查看创建的configmap对象</p>
<blockquote>
<p>注意：kubectl describe 和 kubectl get -o yaml 命令都可以显示由文件创建的键值，不过两者使用的键和值之间的分隔符不同</p>
</blockquote>
<h4 id="通过资源配置清单创建"><a href="#通过资源配置清单创建" class="headerlink" title="通过资源配置清单创建"></a>通过资源配置清单创建</h4><p>基于配置文件创建ConfigMap时，它所使用的字段通常包括<code>apiVersion</code>、<code>kind</code>和metadata字段，以及用于存储数据的关键字段<code>data</code>。 下面就使用配置清单创建一个ConfigMap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat cm1.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: configmap-demo</span><br><span class="line">  namespace: default</span><br><span class="line">data:</span><br><span class="line">  log_level: INFO</span><br><span class="line">  es_file: config/elasticsearch.yaml</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl create -f cm1.yaml </span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl describe configmap configmap-demo </span><br></pre></td></tr></table></figure>

<p>如果配置信息来自文件内容时，则使用配置清单创建ConfigMap资源的便捷性还不如直接通过命令行的方式，因此建议直接使用命令行加载文件或目录的方式进行创建，为了便于配置留存，可以在创建完成后使用 get -o yaml命令获取到相关信息后在进行编辑留存。</p>
<p>pod使用：两种方式，<strong>注入方式有挂载为存储卷和传递为环境变量两种</strong></p>
<h4 id="1）ConfigMap载入Pod方式之环境变量"><a href="#1）ConfigMap载入Pod方式之环境变量" class="headerlink" title="1）ConfigMap载入Pod方式之环境变量"></a>1）ConfigMap载入Pod方式之环境变量</h4><p>在Pod中，获取环境变量值的方式之一就包括ConfigMap对象中的数据，这一点通过在env字段中为valueFrom内嵌configMapKeyRef对象即可实现，格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">valueFrom:</span><br><span class="line">  configMapKeyRef:</span><br><span class="line">    key:</span><br><span class="line">    name:</span><br><span class="line">    optional:</span><br></pre></td></tr></table></figure>

<p>字段name值为要引用的ConfigMap对象的名称 字段key可用于指定要引用ConfigMap对象中某键的键名 字段optional用于为当前Pod资源指明此引用是否为可选</p>
<p>此类环境变量的使用方式与直接定义的环境变量并无区别，它们可被用于容器的启动脚本或直接传递给容器应用等。</p>
<h4 id="传递ConfigMap中的单个Key"><a href="#传递ConfigMap中的单个Key" class="headerlink" title="传递ConfigMap中的单个Key"></a>传递ConfigMap中的单个Key</h4><p>下面示例中包含了两个资源，彼此之间使用 “–” 相分隔，第一个资源是名为 configmap-demo 的 ConfigMap 对象，它包含了两个键值数据；第二个资源是名为 busybox 的 Pod对象，它通过环境变量引用了configmap-demo对象中的键值数据，并将其直接传给了自定义运行的容器应用httpd：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat cm1.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: configmap-demo</span><br><span class="line">  namespace: default</span><br><span class="line">data:</span><br><span class="line">  log_level: INFO</span><br><span class="line">  httpd_port: &quot;8080&quot;</span><br><span class="line">  es_file: config/elasticsearch.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot;,&quot;-p&quot;,&quot;$(HTTPD_PORT)&quot;,&quot;$(ES_FILE)&quot; ]</span><br><span class="line">        env:</span><br><span class="line">        - name: HELLO_WORLD</span><br><span class="line">          value: just a demo</span><br><span class="line">        - name: MY_NODE_NAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: spec.nodeName</span><br><span class="line">        - name: MY_NODE_IP</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: status.hostIP</span><br><span class="line">        - name: MY_POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">        - name: HTTPD_PORT               #定义第一个变量名称</span><br><span class="line">          valueFrom:                     #引用变量</span><br><span class="line">            configMapKeyRef:             #引用来自configMap的变量</span><br><span class="line">              name: configmap-demo       #指定ConfigMap的名称</span><br><span class="line">              key: httpd_port            #指定ConfigMap中要引用的key名称</span><br><span class="line">        - name: LOG_LEVEL</span><br><span class="line">          valueFrom:</span><br><span class="line">            configMapKeyRef:</span><br><span class="line">              name: configmap-demo</span><br><span class="line">              key: log_level</span><br><span class="line">        - name: ES_FILE</span><br><span class="line">          valueFrom:</span><br><span class="line">            configMapKeyRef:</span><br><span class="line">              name: configmap-demo</span><br><span class="line">              key: es_file</span><br></pre></td></tr></table></figure>

<p>注意，在command和args字段中引用环境变量要使用<code>$(VAR_NAME)</code>的格式，待上面配置文件中的资源创建完成后，可以通过如下命令验证Pod资源监听的端口等配置信息是否为 configmap-demo中定义的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   busybox-86d74c5877-dqnw2  -- ps aux</span><br><span class="line">PID   USER     TIME  COMMAND</span><br><span class="line">    1 root      0:00 httpd -f -p 8080 config/elasticsearch.yaml</span><br><span class="line">   20 root      0:00 ps aux</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl exec -it   busybox-86d74c5877-dqnw2   -- printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=busybox-86d74c5877-dqnw2</span><br><span class="line">MY_POD_NAMESPACE=default</span><br><span class="line">HTTPD_PORT=8080</span><br><span class="line">LOG_LEVEL=INFO</span><br><span class="line">ES_FILE=config/elasticsearch.yaml</span><br><span class="line">HELLO_WORLD=just a demo</span><br><span class="line">MY_NODE_NAME=172.16.10.21</span><br><span class="line">MY_NODE_IP=172.16.10.21</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443</span><br><span class="line">TERM=xterm</span><br><span class="line">HOME=/root</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl exec -it   busybox-86d74c5877-dqnw2  -- env | grep HTTPD</span><br><span class="line">HTTPD_PORT=8080</span><br></pre></td></tr></table></figure>

<p>注意：创建引用了ConfigMap资源的Pod对象时，被引用的资源必须事先存在，否则将无法启动相应的容器，直到被依赖的资源创建完成为止。不过，那些未引用不存在的ConfigMap资源的容器将不受此影响。另外，ConfigMap是名称空间级别的资源，它必须与引用它的Pod资源在同一个名称空间中。</p>
<h4 id="传递ConfigMap中的所有Key"><a href="#传递ConfigMap中的所有Key" class="headerlink" title="传递ConfigMap中的所有Key"></a>传递ConfigMap中的所有Key</h4><p>如果我们要引入的变量有很多呢？此时，为容器依次配置相应的环境变量是一件很烦躁的事情，而且容易出错，对此，Pod资源支持在容器中使用<code>envFrom</code>字段直接将ConfigMap资源中的所有键值一次性地完整导入。格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox</span><br><span class="line">    image: docker.io/library/busybox:1.28.4</span><br><span class="line">    envFrom:</span><br><span class="line">    - prefix: HTCPG_</span><br><span class="line">      configMapRef:</span><br><span class="line">        name: configmap_name</span><br><span class="line">        optional: true</span><br></pre></td></tr></table></figure>

<p>envFrom字段是对象列表，可用于同时从多个ConfigMap对象导入键值数据。 为了避免从多个ConfigMap引入键值数据时产生键key重名(名称冲突)，可以在每个引用中将被导入的键使用 prefix 字段指定一个特性的前缀，如 <code>HTCPG_</code> 一类的字符串，于是，ConfigMap对象中的<code>httpd_port</code>将成为Pod资源中名为<code>HTCPG_httpd_port</code>的变量。</p>
<blockquote>
<p>如果键名中使用了连接线 “-“，那么在转换为变量时，连接线将自动被替换为下划线 “_“。</p>
</blockquote>
<p>如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat cm1.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: configmap-demo</span><br><span class="line">  namespace: default</span><br><span class="line">data:</span><br><span class="line">  log_level: INFO</span><br><span class="line">  httpd_port: &quot;8080&quot;</span><br><span class="line">  es_file: config/elasticsearch.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot;,&quot;-p&quot;,&quot;$(HTCPG_httpd_port)&quot;,&quot;$(HTCPG_es_file)&quot; ]</span><br><span class="line">        envFrom:</span><br><span class="line">        - prefix: HTCPG_</span><br><span class="line">          configMapRef:</span><br><span class="line">            name: configmap-demo</span><br><span class="line">            optional: false</span><br><span class="line">        #- prefix: HTCPG1_</span><br><span class="line">        #  configMapRef:</span><br><span class="line">        #    name: configmap-demo1</span><br><span class="line">        #    optional: false</span><br></pre></td></tr></table></figure>

<p>待Pod资源创建完成后，可通过查看其环境变量验证其导入的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   busybox-6c685648cc-ltkdb   -- ps aux</span><br><span class="line">PID   USER     TIME  COMMAND</span><br><span class="line">    1 root      0:00 httpd -f -p 8080 config/elasticsearch.yaml</span><br><span class="line">   50 root      0:00 ps aux</span><br><span class="line">[root@localhost configmap]# kubectl exec -it   busybox-6c685648cc-ltkdb   -- printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=busybox-6c685648cc-ltkdb</span><br><span class="line">HTCPG_es_file=config/elasticsearch.yaml</span><br><span class="line">HTCPG_httpd_port=8080</span><br><span class="line">HTCPG_log_level=INFO</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.43.0.1</span><br><span class="line">TERM=xterm</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：从ConfigMap对象导入资源时，prefix为可选字段，不定义时，所有变量名同ConfigMap中的键名。如果不存在键名冲突的可能性，例如从单个ConfigMap对象导入变量或在ConfigMap对象中定义键名时依然添加了特定的前缀，那么省略前缀的定义即不会导致键名冲突，又能保持变量的简洁。</p>
</blockquote>
<h4 id="2）ConfigMap载入Pod方式之存储卷"><a href="#2）ConfigMap载入Pod方式之存储卷" class="headerlink" title="2）ConfigMap载入Pod方式之存储卷"></a>2）ConfigMap载入Pod方式之存储卷</h4><p>        若ConfigMap对象中的键值来源于较长的文件内容，那么使用环境变量将其导入会使得变量值占据过多的内存空间而不易清理。此类数据通常用于为容器应用提供配置文件，因此将其内存直接作为文件进行引用方为较好的选择，其实现方式是，在定义Pod资源时，将此类ConfigMap对象配置为ConfigMap类型的存储卷，而后由容器将其挂载至特定的挂载点后直接进行访问。</p>
<h4 id="2-1-挂载整个存储卷"><a href="#2-1-挂载整个存储卷" class="headerlink" title="2.1 挂载整个存储卷"></a>2.1 挂载整个存储卷</h4><p>        关联为Pod资源的存储卷时，ConfigMap对象中的每个键都对应地对应为一个文件，键名转为文件名，而值则为相应文件的内容，即便是通过直接创建的键值数据，也一样表现为文件视图。挂载于容器上之后，由键值数据表现出的文件位于挂载点目录中，容器中的进程可直接读取这些文件的内容。</p>
<p>配置Pod资源时，基于存储卷的方式引用ConfigMap对象的方法非常简单，仅需要指明卷名称及要应用的ConfigMap对象名称即可。</p>
<p><strong>2.1.1).创建配置文件</strong> 我们下面创建三个Nginx配置文件，然后将这三个配置文件挂载到Nginx的配置目录中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# ls config/</span><br><span class="line">elasticsearch.yaml  my.cnf  nginx.conf</span><br></pre></td></tr></table></figure>

<p><strong>2.1.2).创建ConfigMap对象</strong></p>
<p>基于目录创建config-files对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create configmap config-files --from-file=config/</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl describe  cm config-files -n default</span><br></pre></td></tr></table></figure>

<p><strong>2.1.3).创建Pod资源清单来引用ConfigMap对象并将其挂载至相应指定的目录中</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        #args: [ &quot;-f&quot;,&quot;-p&quot;,&quot;$(HTCPG_httpd_port)&quot;,&quot;$(HTCPG_es_file)&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        volumeMounts:                                    #卷挂载配置</span><br><span class="line">        - name: config                           #卷名称</span><br><span class="line">          mountPath: /tmp                #挂载到容器中的路径目录</span><br><span class="line">          readOnly: true                                    #是否只读</span><br><span class="line">      volumes:                                                    #卷配置</span><br><span class="line">      - name: config                                 #定义一个卷名称</span><br><span class="line">        configMap:                                                #configMap配置</span><br><span class="line">          name: config-files                            #指定configMap名称</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-查看Pod挂载状态"><a href="#2-1-4-查看Pod挂载状态" class="headerlink" title="2.1.4) 查看Pod挂载状态"></a>2.1.4) <strong>查看Pod挂载状态</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl describe  pod/busybox-679b55c4fb-x6wdc | grep -A 2 Mounts</span><br><span class="line">    Mounts:</span><br><span class="line">      /tmp from config (ro)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-cztvq (ro)</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-679b55c4fb-x6wdc -- ls /tmp/ -al</span><br><span class="line">total 0</span><br><span class="line">drwxrwxrwx    3 root     root           117 Jan 26 07:20 .</span><br><span class="line">drwxr-xr-x    1 root     root            51 Jan 26 07:20 ..</span><br><span class="line">drwxr-xr-x    2 root     root            64 Jan 26 07:20 ..2022_01_26_07_20_49.547544433</span><br><span class="line">lrwxrwxrwx    1 root     root            31 Jan 26 07:20 ..data -&gt; ..2022_01_26_07_20_49.547544433</span><br><span class="line">lrwxrwxrwx    1 root     root            25 Jan 26 07:20 elasticsearch.yaml -&gt; ..data/elasticsearch.yaml</span><br><span class="line">lrwxrwxrwx    1 root     root            13 Jan 26 07:20 my.cnf -&gt; ..data/my.cnf</span><br><span class="line">lrwxrwxrwx    1 root     root            17 Jan 26 07:20 nginx.conf -&gt; ..data/nginx.conf</span><br></pre></td></tr></table></figure>

<h4 id="2-2-挂载存储卷中的部分键值"><a href="#2-2-挂载存储卷中的部分键值" class="headerlink" title="2.2 挂载存储卷中的部分键值"></a>2.2 挂载存储卷中的部分键值</h4><p>有时候，用户很可能不期望在容器中挂载某ConfigMap存储卷中的所有文件，这在通过一个ConfigMap对象为单个Pod资源中的多个容器分别提供配置时尤其常见。例如前面示例中，用户可能只期望在容器中挂载ConfigMap存储卷后只“导出”其中出my.cnf和elasticsearch.yaml文件.此时将其 volumes 配置段改为如下所示的内容即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        #args: [ &quot;-f&quot;,&quot;-p&quot;,&quot;$(HTCPG_httpd_port)&quot;,&quot;$(HTCPG_es_file)&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        volumeMounts:                                   #卷挂载配置</span><br><span class="line">        - name: config                                  #卷名称</span><br><span class="line">          mountPath: /tmp                               #挂载到容器中的路径目录</span><br><span class="line">          readOnly: true                                #是否只读</span><br><span class="line">      volumes:                                          #卷配置</span><br><span class="line">      - name: config                                    #定义一个卷名称</span><br><span class="line">        configMap:                                      #configMap配置</span><br><span class="line">          name: config-files                            #指定configMap名称</span><br><span class="line">          items:                                        #config-files ConfigMap中的键</span><br><span class="line">          - key: my.cnf                                 #指定要挂载键  默认文件名就是key,原文件名(key的名称)</span><br><span class="line">            path: my.cnf                                #挂载的路径,修改之后的文件名(key的名称)</span><br><span class="line">            mode: 0644                                  #挂载后的文件权限</span><br><span class="line">          - key: elasticsearch.yaml</span><br><span class="line">            path: elasticsearch.yaml</span><br><span class="line">            mode: 0644</span><br></pre></td></tr></table></figure>

<p>1)假如不想以key名作为配置文件名可以引入<code>items</code> 字段，在其中逐个指定要用相对路径<code>path</code>替换的key</p>
<p>2)items还有一个作用，就是只有items下的key对应的文件会被挂载到容器中。</p>
<p>ConfigMap存储卷的items字段的值是一个对象列表，可嵌套使用的字段有三个，具体如下：</p>
<ul>
<li><strong>key</strong>：要引用的键名称，必选字段。</li>
<li><strong>path</strong>：对应的键于挂载点目录中生成的文件相对路径，可以不同于键名称，必选字段。</li>
<li><strong>mode</strong>：文件的权限模型，可用范围为0到0777。</li>
</ul>
<p>验证：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-67c86587bf-5hjfm -- ls /tmp/</span><br><span class="line">elasticsearch.yaml  my.cnf</span><br><span class="line">[root@localhost configmap]# kubectl describe  pod/busybox-67c86587bf-5hjfm | grep -A 2 Mounts</span><br><span class="line">    Mounts:</span><br><span class="line">      /tmp from config (ro)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-4tsq4 (ro)</span><br></pre></td></tr></table></figure>

<h4 id="2-3-独立挂载存储卷中的键值"><a href="#2-3-独立挂载存储卷中的键值" class="headerlink" title="2.3 独立挂载存储卷中的键值"></a>2.3 独立挂载存储卷中的键值</h4><p>上面的两种方式中，无论是装载所有文件还是部分文件，挂载点目录下原有的文件都会被隐藏或者称为覆盖，在我们没有挂载的时候，&#x2F;etc&#x2F;nginx&#x2F;conf.d目录下有default.conf文件，当我们挂载之后default.conf就被隐藏或者说覆盖掉了，但有时候我们希望挂载进的文件不覆盖相应目录下的其它文件，这个时候就可以通过<code>volumeMounts</code>属性中的<code>subPath</code>字段来解决，它可以支持用户从存储卷挂载单个文件或者单个目录而非整个存储卷。</p>
<p>subPath的使用方法一共有两种：<br>1. 同一个pod中多容器挂载同一个卷时提供隔离<br>2. 将configMap和secret作为文件挂载到容器中而不覆盖挂载目录下的文件</p>
<p>主要解释第一点，按照k8s官网的解释，subPath在是挂载卷中的存储目录，不指定默认存储在卷的根目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">     containers:</span><br><span class="line">     - name: busybox</span><br><span class="line">       #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">       #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">       image: docker.io/library/busybox:1.28.4</span><br><span class="line">       command: [ &quot;httpd&quot; ]                           </span><br><span class="line">       #args: [ &quot;-f&quot;,&quot;-p&quot;,&quot;$(HTCPG_httpd_port)&quot;,&quot;$(HTCPG_es_file)&quot; ]</span><br><span class="line">       args: [ &quot;-f&quot; ]</span><br><span class="line">       volumeMounts:                                   #卷挂载配置</span><br><span class="line">       - name: mysql-config                                  #卷名称</span><br><span class="line">         mountPath: /etc/my.cnf                               #挂载到容器中的路径目录 不指定subPath 那么/etc/my.cnf当做目录</span><br><span class="line">         subPath: my.cnf                           #subPath此时指的就是configMap中的key，也就是文件名</span><br><span class="line">         readOnly: true                                #是否只读</span><br><span class="line">       - name: es-config                                  #卷名称</span><br><span class="line">         mountPath: /etc/elasticsearch.yaml                               #挂载到容器中的路径目录</span><br><span class="line">         subPath: elasticsearch.yaml</span><br><span class="line">         readOnly: true                                #是否只读</span><br><span class="line">     volumes:                                          #卷配置</span><br><span class="line">     - name: mysql-config                                    #定义一个卷名称</span><br><span class="line">       configMap:                                      #configMap配置</span><br><span class="line">         name: mysql-config-files                            #指定configMap名称</span><br><span class="line">     - name: es-config                                    #定义一个卷名称</span><br><span class="line">       configMap:                                      #configMap配置</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\# 如果没有subPath，则//etc/my.cnf和/etc/elasticsearch.yaml将被当成一个目录而不是文件，根据Linux挂载的概念，该目录下的所有文件会被覆盖。</span><br></pre></td></tr></table></figure>

<p>subPath此时指的就是configMap中的key，也就是文件名</p>
<p>测试一下：</p>
<p>首先创建一个包含两个container的pod，对应的yaml文件如下，两个container挂载目录下的文件都会存储在卷的根目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox-mysql</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        #- name: mysql-config</span><br><span class="line">        - name: es-config</span><br><span class="line">          mountPath: /etc/wubo</span><br><span class="line">          #subPath: my.cnf</span><br><span class="line">          #readOnly: false</span><br><span class="line">      - name: busybox-es</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;/bin/sh&quot; ]</span><br><span class="line">        args: [ &quot;-c&quot;,&quot;sleep 30000&quot; ]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: es-config</span><br><span class="line">          mountPath: /etc/wubo</span><br><span class="line">          #subPath: elasticsearch.yaml</span><br><span class="line">          #readOnly: false</span><br><span class="line">      volumes:</span><br><span class="line">      - name: es-config</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /opt/wubo</span><br><span class="line">          type: Directory</span><br></pre></td></tr></table></figure>

<p>接下来做一个简单的验证，首先进到busybox-mysql中在&#x2F;etc&#x2F;wubo&#x2F;a.txt下创建一个a.txt的文件，退出之后进入busybox-es的&#x2F;etc&#x2F;wubo&#x2F;a.txt目录，因为未指定subPath，文件会直接存储在卷的根目录下，所以在busybox-es下可以看见busybox-mysqlr刚刚新建的a.txt文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@localhost configmap]# kubectl exec -it   pod/busybox-6fbbc45c5c-qfxpw -c busybox-mysql -- sh</span><br><span class="line">/etc # cd etc/wubo/</span><br><span class="line">/etc/wubo # mkdir wuqi</span><br><span class="line">/etc/wubo # cd wuqi/</span><br><span class="line">/etc/wubo/wuqi # touch  a</span><br><span class="line">/etc/wubo/wuqi # echo aaa &gt; a</span><br><span class="line">/etc/wubo/wuqi # cat a</span><br><span class="line">aaa</span><br><span class="line"></span><br><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-6fbbc45c5c-qfxpw -c busybox-es -- sh</span><br><span class="line">/etc # cd etc/wubo/wuqi</span><br><span class="line">/etc/wubo # cd wuqi/</span><br><span class="line">/etc/wubo/wuqi # cat a</span><br><span class="line">aaa</span><br></pre></td></tr></table></figure>

<p>接下来试着加入subPath，对应的yaml文件如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox-mysql</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        #- name: mysql-config</span><br><span class="line">        - name: es-config</span><br><span class="line">          mountPath: /etc/wubo</span><br><span class="line">          subPath: mysql</span><br><span class="line">          #readOnly: false</span><br><span class="line">      - name: busybox-es</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;/bin/sh&quot; ]</span><br><span class="line">        args: [ &quot;-c&quot;,&quot;sleep 30000&quot; ]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: es-config</span><br><span class="line">          mountPath: /etc/wubo</span><br><span class="line">          subPath: es</span><br><span class="line">          #readOnly: false</span><br><span class="line">      volumes:</span><br><span class="line">      - name: es-config</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /opt/wubo</span><br><span class="line">          type: Directory</span><br></pre></td></tr></table></figure>

<p>同样进入两个容器的挂载目录下创建新文件，可以看到subPath起到了隔离的作用,在另一个容易看不到目录和文件了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-f6966c85-b4fvl -c busybox-mysql -- sh</span><br><span class="line">/ # cd etc/wubo</span><br><span class="line">/etc/wubo # mkdir wuqi</span><br><span class="line">/etc/wubo # cd wuqi/</span><br><span class="line">/etc/wubo/wuqi # echo aaa &gt; a</span><br><span class="line">/etc/wubo/wuqi # cat a</span><br><span class="line">aaa</span><br><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-f6966c85-b4fvl -c busybox-es -- sh</span><br><span class="line">/ # cd etc/</span><br><span class="line">/etc # ls</span><br><span class="line">group        hostname     hosts        localtime    network      passwd       resolv.conf  shadow       wubo</span><br><span class="line">/etc # cd wubo/</span><br><span class="line">/etc/wubo # ls</span><br><span class="line">/etc/wubo # pwd</span><br><span class="line">/etc/wubo</span><br></pre></td></tr></table></figure>

<p>例如下面示例&#x2F;etc  目录中挂载一个elasticsearch.yaml和my.cnf 文件，并且不覆盖原来目录etc下的原有的 文件。</p>
<p>删除之前看下容器里面的文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-67c86587bf-5hjfm -- ls /etc</span><br><span class="line">group        hosts        network      resolv.conf</span><br><span class="line">hostname     localtime    passwd       shadow</span><br></pre></td></tr></table></figure>

<p>是没有 elasticsearch.yaml和my.cnf两个文件的</p>
<p><strong>2.3.1） 删除原来创建的ConfigMap和Pod</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl delete cm config-files </span><br><span class="line">[root@localhost configmap]# kubectl delete -f busybox.yaml </span><br></pre></td></tr></table></figure>

<p><strong>2.3.2）创建两个ConfigMap，分别用于测试文件</strong>elasticsearch.yaml和my.cnf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl create configmap mysql-config-files --from-file=./config/mysql/my.cnf</span><br><span class="line">configmap/mysql-config-files created</span><br><span class="line">[root@localhost configmap]# kubectl create configmap es-config-files --from-file=./config/es/elasticsearch.yaml</span><br><span class="line">configmap/es-config-files created</span><br></pre></td></tr></table></figure>

<p><strong>2.3.3）创建Pod资源配置清单</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# cat busybox.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: busybox</span><br><span class="line">  namespace: default</span><br><span class="line">  labels: &#123;name: busybox&#125;</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: busybox&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: busybox</span><br><span class="line">      labels: &#123;name: busybox&#125;</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: busybox</span><br><span class="line">        #image: harbor.jettech.com/jettechtools/busybox:1.21.4</span><br><span class="line">        #image: 172.16.10.5:5000/library/busybox:1.21.4</span><br><span class="line">        image: docker.io/library/busybox:1.28.4</span><br><span class="line">        command: [ &quot;httpd&quot; ]</span><br><span class="line">        #args: [ &quot;-f&quot;,&quot;-p&quot;,&quot;$(HTCPG_httpd_port)&quot;,&quot;$(HTCPG_es_file)&quot; ]</span><br><span class="line">        args: [ &quot;-f&quot; ]</span><br><span class="line">        volumeMounts:                                   #卷挂载配置</span><br><span class="line">        - name: mysql-config                                  #卷名称</span><br><span class="line">          mountPath: /etc/my.cnf                               #挂载到容器中的路径目录</span><br><span class="line">          subPath: my.cnf</span><br><span class="line">          readOnly: true                                #是否只读</span><br><span class="line">        - name: es-config                                  #卷名称</span><br><span class="line">          mountPath: /etc/elasticsearch.yaml                               #挂载到容器中的路径目录</span><br><span class="line">          subPath: elasticsearch.yaml</span><br><span class="line">          readOnly: true                                #是否只读</span><br><span class="line">      volumes:                                          #卷配置</span><br><span class="line">      - name: mysql-config                                    #定义一个卷名称</span><br><span class="line">        configMap:                                      #configMap配置</span><br><span class="line">          name: mysql-config-files                            #指定configMap名称</span><br><span class="line">      - name: es-config                                    #定义一个卷名称</span><br><span class="line">        configMap:                                      #configMap配置</span><br><span class="line">          name: es-config-files                            #指定configMap</span><br></pre></td></tr></table></figure>

<p><strong>2.3.4）查看Pod对象挂载状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost configmap]# kubectl exec -it   pod/busybox-7548665cfc-26kc6 -- ls /etc/</span><br><span class="line">elasticsearch.yaml  localtime           resolv.conf</span><br><span class="line">group               my.cnf              shadow</span><br><span class="line">hostname            network</span><br><span class="line">hosts               passwd</span><br><span class="line">[root@localhost configmap]# kubectl describe   pod/busybox-7548665cfc-26kc6 | grep -A 3 Mounts</span><br><span class="line">    Mounts:</span><br><span class="line">      /etc/elasticsearch.yaml from es-config (ro,path=&quot;elasticsearch.yaml&quot;)</span><br><span class="line">      /etc/my.cnf from mysql-config (ro,path=&quot;my.cnf&quot;)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-7sfvm (ro)</span><br></pre></td></tr></table></figure>

<h2 id="使用ConfigMap资源的注意事项"><a href="#使用ConfigMap资源的注意事项" class="headerlink" title="使用ConfigMap资源的注意事项"></a>使用ConfigMap资源的注意事项</h2><p>在Pod资源中调用ConfigMap对象时需要注意以下几个问题。</p>
<ul>
<li>以存储卷访问引用的ConfigMap必须在Pod启动前存在，除非在Pod中将他们全部标记为<code>optional</code>，否则会导致Pod无法正常启动的错误，同样即使存在ConfigMap，在引用ConfigMap中的键不存在时，也会导致一样的错误。</li>
<li>当以环境变量注入的ConfigMap中的键不存在时会被忽略，Pod可以正常启动，但错误引用的信息会以<code>InvalidVariableNames</code>事件记录于日志中。</li>
<li>ConfigMap是namespace级的资源，因此引用它的Pod必须处于同一名称空间中。</li>
<li>kubelet不支持引用Kubernetes API Server上不存在的ConfigMap，这包括那些通过kubelet的<code>--manifest-url</code>或<code>--config</code>选项，以及 kubelet REST API 创建的Pod。</li>
</ul>
<p>redis完整案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">[root@jettoloader redis]# cat jettoloader-redis-develop-poc.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: jettoloader-poc</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: jettoloader-redis-poc-pvc</span><br><span class="line">  namespace: jettoloader-poc</span><br><span class="line">spec:</span><br><span class="line">  accessModes:  #访问模式</span><br><span class="line">  #- ReadWriteOnce</span><br><span class="line">  #- ReadWriteOncePod</span><br><span class="line">  - ReadWriteMany</span><br><span class="line">  #- ReadOnlyMany</span><br><span class="line">  resources: #申请资源，1Gi存储空间</span><br><span class="line">    requests:</span><br><span class="line">      storage: 1Gi</span><br><span class="line">  storageClassName: jettech-nfs-storage</span><br><span class="line">  #selector:</span><br><span class="line">  #  matchLabels:</span><br><span class="line">  #    name: &quot;wubo-pv1&quot;</span><br><span class="line">  #  matchExpressions:</span><br><span class="line">  #    - &#123;key: environment, operator: In, values: [dev]&#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: jettoloader-redis-poc-conf</span><br><span class="line">  namespace: jettoloader-poc </span><br><span class="line">data:</span><br><span class="line">  redis.conf: |</span><br><span class="line">    bind 0.0.0.0</span><br><span class="line">    protected-mode yes</span><br><span class="line">    port 6379</span><br><span class="line">    tcp-backlog 511</span><br><span class="line">    timeout 0</span><br><span class="line">    tcp-keepalive 300</span><br><span class="line">    daemonize no</span><br><span class="line">    supervised no</span><br><span class="line">    #pidfile /var/run/redis_6379.pid</span><br><span class="line">    pidfile /data/redis_6379.pid</span><br><span class="line">    loglevel notice</span><br><span class="line">    logfile /var/log/redis/redis.log</span><br><span class="line">    #logfile /data/redis.log</span><br><span class="line">    databases 16</span><br><span class="line">    save 900 1</span><br><span class="line">    save 300 10</span><br><span class="line">    save 60 10000</span><br><span class="line">    stop-writes-on-bgsave-error yes</span><br><span class="line">    rdbcompression yes</span><br><span class="line">    rdbchecksum yes</span><br><span class="line">    dbfilename dump.rdb</span><br><span class="line">    #dir /var/lib/redis</span><br><span class="line">    dir /data</span><br><span class="line">    slave-serve-stale-data yes</span><br><span class="line">    slave-read-only yes</span><br><span class="line">    repl-diskless-sync no</span><br><span class="line">    repl-diskless-sync-delay 5</span><br><span class="line">    repl-disable-tcp-nodelay no</span><br><span class="line">    slave-priority 100</span><br><span class="line">    requirepass &quot;123456aA&quot;</span><br><span class="line">    appendonly no</span><br><span class="line">    appendfilename &quot;appendonly.aof&quot;</span><br><span class="line">    appendfsync everysec</span><br><span class="line">    no-appendfsync-on-rewrite no</span><br><span class="line">    auto-aof-rewrite-percentage 100</span><br><span class="line">    auto-aof-rewrite-min-size 64mb</span><br><span class="line">    aof-load-truncated yes</span><br><span class="line">    lua-time-limit 5000</span><br><span class="line">    slowlog-log-slower-than 10000</span><br><span class="line">    slowlog-max-len 128</span><br><span class="line">    latency-monitor-threshold 0</span><br><span class="line">    notify-keyspace-events &quot;&quot;</span><br><span class="line">    hash-max-ziplist-entries 512</span><br><span class="line">    hash-max-ziplist-value 64</span><br><span class="line">    list-max-ziplist-size -2</span><br><span class="line">    list-compress-depth 0</span><br><span class="line">    set-max-intset-entries 512</span><br><span class="line">    zset-max-ziplist-entries 128</span><br><span class="line">    zset-max-ziplist-value 64</span><br><span class="line">    hll-sparse-max-bytes 3000</span><br><span class="line">    activerehashing yes</span><br><span class="line">    client-output-buffer-limit normal 0 0 0</span><br><span class="line">    client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">    client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">    hz 10</span><br><span class="line">    aof-rewrite-incremental-fsync yes</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels: &#123;name: jettoloader-redis-poc-server&#125;</span><br><span class="line">  name: jettoloader-redis-poc-server</span><br><span class="line">  namespace: jettoloader-poc</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - &#123;name: t16379, nodePort: 16379, port: 6379, protocol: TCP, targetPort: t6379&#125;</span><br><span class="line">  selector: &#123;name: jettoloader-redis-poc-pod&#125;</span><br><span class="line">  type: NodePort</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels: &#123;name: jettoloader-redis-poc-deploy&#125;</span><br><span class="line">  name: jettoloader-redis-poc-deploy</span><br><span class="line">  namespace: jettoloader-poc</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels: &#123;name: jettoloader-redis-poc-pod&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels: &#123;name: jettoloader-redis-poc-pod&#125;</span><br><span class="line">      name: jettoloader-redis-poc-pod</span><br><span class="line">    spec:</span><br><span class="line">      #affinity:</span><br><span class="line">      #  nodeAffinity:</span><br><span class="line">      #    requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">      #      nodeSelectorTerms:</span><br><span class="line">      #      - matchExpressions:</span><br><span class="line">      #        - key: envtype</span><br><span class="line">      #          operator: In</span><br><span class="line">      #          values:</span><br><span class="line">      #          - poc</span><br><span class="line">      #initContainers:</span><br><span class="line">      containers:</span><br><span class="line">      - name: jettoloader-redis-poc-container</span><br><span class="line">        image: 172.16.10.21:5000/jettechtools/redis:3.2</span><br><span class="line">        #lifecycle:</span><br><span class="line">        #  postStart:</span><br><span class="line">        #    exec:</span><br><span class="line">        #      command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;mkdir -p /var/log/redis &amp;&amp; ln -sf /data/redis.log /var/log/redis/redis.log&quot;]</span><br><span class="line">          #preStop:</span><br><span class="line">        #env:</span><br><span class="line">        #  - &#123;name: APPLY_PORT, value: &#x27;8097&#x27;&#125;</span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: true</span><br><span class="line">        ports:</span><br><span class="line">        - &#123;containerPort: 6379, name: t6379, protocol: TCP &#125;</span><br><span class="line">        #volumeMounts:</span><br><span class="line">        #- name:  redis-conf</span><br><span class="line">        #  mountPath: /etc/redis/</span><br><span class="line">        #- name:  redis-data</span><br><span class="line">        #  mountPath: /data</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: jettoloader-redis-poc-conf</span><br><span class="line">          mountPath: /etc/redis/redis.conf</span><br><span class="line">          subPath: redis.conf #cm中的key</span><br><span class="line">          readOnly: true</span><br><span class="line">        - name: jettoloader-redis-poc-data</span><br><span class="line">          mountPath: /data</span><br><span class="line">        command:</span><br><span class="line">        - &quot;redis-server&quot;</span><br><span class="line">        args:</span><br><span class="line">        - &quot;/etc/redis/redis.conf&quot;</span><br><span class="line">        - &quot;--appendonly yes&quot;</span><br><span class="line">        imagePullPolicy: Always #[Always | Never | IfNotPresent]</span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: true</span><br><span class="line">      #hostNetwork: true</span><br><span class="line">      restartPolicy: Always #Never</span><br><span class="line">      volumes:</span><br><span class="line">      - name: jettoloader-redis-poc-conf</span><br><span class="line">        configMap:</span><br><span class="line">          name: jettoloader-redis-poc-conf</span><br><span class="line">          items:</span><br><span class="line">          - key: redis.conf</span><br><span class="line">            path: redis.conf</span><br><span class="line">      - name: jettoloader-redis-poc-data</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: jettoloader-redis-poc-pvc</span><br><span class="line">      #volumes:</span><br><span class="line">      #- name: redis-conf</span><br><span class="line">      #  nfs:</span><br><span class="line">      #    server: 172.16.10.4</span><br><span class="line">      #    path: /var/ftp/jettech/jettoloader/tools/poc/redis/conf</span><br><span class="line">      #- name: redis-data</span><br><span class="line">      #  nfs:</span><br><span class="line">      #    server: 172.16.10.4</span><br><span class="line">      #    path: /var/ftp/jettech/jettoloader/tools/poc/redis/data</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.jing.xj.cn">小井</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.jing.xj.cn/2023/10/23/k8s%E5%90%91%E5%AE%B9%E5%99%A8%E6%8F%90%E4%BE%9B%E9%85%8D%E7%BD%AE-%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF%E6%80%BB%E7%BB%93configmap/">https://blog.jing.xj.cn/2023/10/23/k8s%E5%90%91%E5%AE%B9%E5%99%A8%E6%8F%90%E4%BE%9B%E9%85%8D%E7%BD%AE-%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF%E6%80%BB%E7%BB%93configmap/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.jing.xj.cn" target="_blank">编程知识学习笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/">运维</a></div><div class="post_share"><div class="social-share" data-image="/img/favicon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/23/k8s%E4%B8%AD%E4%BD%BF%E7%94%A8nfs%E5%88%9B%E5%BB%BAstorageClass/" title="k8s中使用nfs创建storageClass"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">k8s中使用nfs创建storageClass</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/29/Linux%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5inotify+rsync/" title="Linux系统实时数据同步inotify+rsync"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux系统实时数据同步inotify+rsync</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/23/MinIO%E5%AE%A2%E6%88%B7%E7%AB%AFmc%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB_minio%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/" title="MinIO客户端mc实现数据迁移_minio数据迁移"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-23</div><div class="title">MinIO客户端mc实现数据迁移_minio数据迁移</div></div></a></div><div><a href="/2023/10/23/k8s%E4%B8%AD%E4%BD%BF%E7%94%A8nfs%E5%88%9B%E5%BB%BAstorageClass/" title="k8s中使用nfs创建storageClass"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-23</div><div class="title">k8s中使用nfs创建storageClass</div></div></a></div><div><a href="/2023/08/24/vsftp%E4%B9%8Bdocker%E7%89%88/" title="vsftp之docker版"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-24</div><div class="title">vsftp之docker版</div></div></a></div><div><a href="/2023/07/29/k8s%201.26.2%E5%9F%BA%E4%BA%8Econtainerd1.6.18/" title="k8s 1.26.2基于containerd1.6.18"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-29</div><div class="title">k8s 1.26.2基于containerd1.6.18</div></div></a></div><div><a href="/2023/07/29/docker-compose%E4%B9%8Bv1.x%E4%B8%8Ev2.x%E8%AF%B4%E6%98%8E/" title="docker-compose之v1.x与v2.x说明"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-29</div><div class="title">docker-compose之v1.x与v2.x说明</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Giscus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">小井</div><div class="author-info__description">转载请备注作者： 小井</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来访！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E5%B0%86%E4%BB%8B%E7%BB%8D%E5%90%91%E5%AE%B9%E5%99%A8%E6%8F%90%E4%BE%9B%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">以下将介绍向容器提供配置信息的几种方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">通过命令行参数进行配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%BD%BD%E5%85%A5%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">将配置文件载入镜像文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%AD%98%E5%82%A8%E5%8D%B7%E5%90%91%E5%AE%B9%E5%99%A8%E6%B3%A8%E5%85%A5%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">4.</span> <span class="toc-text">通过存储卷向容器注入配置信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%90%91%E5%AE%B9%E5%99%A8%E6%B3%A8%E5%85%A5%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">5.</span> <span class="toc-text">通过环境变量向容器注入配置信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89valueFrom%EF%BC%9AfieldRef%E3%80%90fieldRef%E4%B8%8B%E9%9D%A2%E6%9C%89fieldPath%E3%80%91%E6%A1%88%E5%88%97"><span class="toc-number">6.</span> <span class="toc-text">1）valueFrom：fieldRef【fieldRef下面有fieldPath】案列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89valueFrom%EF%BC%9AsecretKeyRef%E3%80%90fieldRef%E4%B8%8B%E9%9D%A2%E6%9C%89name%E5%92%8Ckey-%E3%80%91%E6%A1%88%E5%88%97"><span class="toc-number">7.</span> <span class="toc-text">3）valueFrom：secretKeyRef【fieldRef下面有name和key&#96;&#96;】案列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89valueFrom%EF%BC%9A-resourceFieldRef%E3%80%90resourceFieldRef%E4%B8%8B%E9%9D%A2%E6%9C%89resource%E3%80%91%E6%A1%88%E5%88%97"><span class="toc-number">8.</span> <span class="toc-text">4）valueFrom： resourceFieldRef【resourceFieldRef下面有resource】案列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-valueFrom-configMapKeyRef%E6%A1%88%E5%88%97%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">9.</span> <span class="toc-text">2)valueFrom configMapKeyRef案列如下：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ConfigMap%E8%AF%9E%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">10.</span> <span class="toc-text">ConfigMap诞生的原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ConfigMap%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA-%E6%98%AFnamespace%E7%BA%A7%E5%88%AB%E7%9A%84"><span class="toc-number">11.</span> <span class="toc-text">ConfigMap对象创建 是namespace级别的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%80%9A%E8%BF%87%E9%94%AE%E5%80%BC%E5%88%9B%E5%BB%BAConfigMap"><span class="toc-number">12.</span> <span class="toc-text">1.通过键值创建ConfigMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BAConfigMap%E9%85%8D%E7%BD%AE-Pod-%E4%BD%BF%E7%94%A8-ConfigMap-Kubernetes"><span class="toc-number">13.</span> <span class="toc-text">2.通过文件创建ConfigMap配置 Pod 使用 ConfigMap | Kubernetes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BAConfigMap"><span class="toc-number">14.</span> <span class="toc-text">通过目录创建ConfigMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%95%E5%88%9B%E5%BB%BA"><span class="toc-number">15.</span> <span class="toc-text">通过资源配置清单创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89ConfigMap%E8%BD%BD%E5%85%A5Pod%E6%96%B9%E5%BC%8F%E4%B9%8B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">16.</span> <span class="toc-text">1）ConfigMap载入Pod方式之环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E9%80%92ConfigMap%E4%B8%AD%E7%9A%84%E5%8D%95%E4%B8%AAKey"><span class="toc-number">17.</span> <span class="toc-text">传递ConfigMap中的单个Key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E9%80%92ConfigMap%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89Key"><span class="toc-number">18.</span> <span class="toc-text">传递ConfigMap中的所有Key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89ConfigMap%E8%BD%BD%E5%85%A5Pod%E6%96%B9%E5%BC%8F%E4%B9%8B%E5%AD%98%E5%82%A8%E5%8D%B7"><span class="toc-number">19.</span> <span class="toc-text">2）ConfigMap载入Pod方式之存储卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%8C%82%E8%BD%BD%E6%95%B4%E4%B8%AA%E5%AD%98%E5%82%A8%E5%8D%B7"><span class="toc-number">20.</span> <span class="toc-text">2.1 挂载整个存储卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E6%9F%A5%E7%9C%8BPod%E6%8C%82%E8%BD%BD%E7%8A%B6%E6%80%81"><span class="toc-number">21.</span> <span class="toc-text">2.1.4) 查看Pod挂载状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%8C%82%E8%BD%BD%E5%AD%98%E5%82%A8%E5%8D%B7%E4%B8%AD%E7%9A%84%E9%83%A8%E5%88%86%E9%94%AE%E5%80%BC"><span class="toc-number">22.</span> <span class="toc-text">2.2 挂载存储卷中的部分键值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%8B%AC%E7%AB%8B%E6%8C%82%E8%BD%BD%E5%AD%98%E5%82%A8%E5%8D%B7%E4%B8%AD%E7%9A%84%E9%94%AE%E5%80%BC"><span class="toc-number">23.</span> <span class="toc-text">2.3 独立挂载存储卷中的键值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ConfigMap%E8%B5%84%E6%BA%90%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number"></span> <span class="toc-text">使用ConfigMap资源的注意事项</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/14/pyenv%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" title="pyenv的安装与简单使用">pyenv的安装与简单使用</a><time datetime="2023-11-14T05:27:00.000Z" title="发表于 2023-11-14 13:27:00">2023-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/23/MinIO%E5%AE%A2%E6%88%B7%E7%AB%AFmc%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB_minio%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/" title="MinIO客户端mc实现数据迁移_minio数据迁移">MinIO客户端mc实现数据迁移_minio数据迁移</a><time datetime="2023-10-23T08:27:00.000Z" title="发表于 2023-10-23 16:27:00">2023-10-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/23/k8s%E4%B8%AD%E4%BD%BF%E7%94%A8nfs%E5%88%9B%E5%BB%BAstorageClass/" title="k8s中使用nfs创建storageClass">k8s中使用nfs创建storageClass</a><time datetime="2023-10-23T08:27:00.000Z" title="发表于 2023-10-23 16:27:00">2023-10-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/23/k8s%E5%90%91%E5%AE%B9%E5%99%A8%E6%8F%90%E4%BE%9B%E9%85%8D%E7%BD%AE-%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF%E6%80%BB%E7%BB%93configmap/" title="k8s向容器提供配置-变量信息总结configmap">k8s向容器提供配置-变量信息总结configmap</a><time datetime="2023-10-23T08:27:00.000Z" title="发表于 2023-10-23 16:27:00">2023-10-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/29/Linux%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5inotify+rsync/" title="Linux系统实时数据同步inotify+rsync">Linux系统实时数据同步inotify+rsync</a><time datetime="2023-08-29T08:20:00.000Z" title="发表于 2023-08-29 16:20:00">2023-08-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By 小井</div><div class="framework-info"><a href="https://beian.miit.gov.cn"  style="color:white" target="_blank">豫ICP备2023004735号-1</a>
<br>
<a href="https://www.beian.gov.cn/portal/registerSystemInfo/"  style="color:white" target="_blank">豫公安网备号: 41159102000118</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'emGxGmejigFTU61MtUBW0bnX-gzGzoHsz',
      appKey: '7dwlzKSICh4VT4B46ufAnypu',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function getGiscusTheme (theme) {
  return theme === 'dark' ? 'dark' : 'light'
}

function loadGiscus () {
  const config = Object.assign({
    src: 'https://giscus.app/client.js',
    'data-repo': '1447443432/blogComment',
    'data-repo-id': 'R_kgDOKEooGg',
    'data-category-id': 'DIC_kwDOKEooGs4CYbid',
    'data-mapping': 'pathname',
    'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
    'data-reactions-enabled': '1',
    crossorigin: 'anonymous',
    async: true
  },)

  let ele = document.createElement('script')
  for (let key in config) {
    ele.setAttribute(key, config[key])
  }
  document.getElementById('giscus-wrap').insertAdjacentElement('afterbegin',ele)
}

function changeGiscusTheme (theme) {
  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame')
    if (!iframe) return
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
  }

  sendMessage({
    setConfig: {
      theme: getGiscusTheme(theme)
    }
  });
}

btf.addModeChange('giscus', changeGiscusTheme)

if ('Valine' === 'Giscus' || !true) {
  if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
  else loadGiscus()
} else {
  function loadOtherComment () {
    loadGiscus()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>